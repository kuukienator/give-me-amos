<!DOCTYPE html>
<html>
  <head>
    <title>Give me Amos!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Audiowide|Roboto+Mono&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1>Give me Amos</h1>
    <div class="imageContainer">
      <img style="display: none;" id="gif">
    </div>
    <button id="giveMeAmos">Get some Amos</button>
    <img class="giphyLogo" src="/images/PoweredBy_200px-Black_HorizLogo.png" alt="powered by giphy">
    <script>
      const OFFSET_NAME = 'amos_offset';
      const TOTAL_COUNT = 'amos_count';
      const gifElement = document.querySelector('#gif');
      const giveMeAmos = document.querySelector('#giveMeAmos');

      function getRandomInt(min, max) {
        min = Math.ceil(min);
        max = Math.floor(max);
        return Math.floor(Math.random() * (max - min)) + min;
      }

      function getAmosOffset() {
        return Number(localStorage.getItem(OFFSET_NAME)) || 0;
      }

      function setAmosOffset(offset) {
        return localStorage.setItem(OFFSET_NAME, offset);
      }

      function getAmosCount() {
        return Number(localStorage.getItem(TOTAL_COUNT)) || 0;
      }

      function setAmosCount(count) {
        return localStorage.setItem(TOTAL_COUNT, count);
      }

      function getRandomAmos(total) {
        return getRandomInt(0, total);
      }

      function main() {
        gifElement.style.display = 'none';
        // const offest = getRandomAmos(getAmosCount());
        const offest = getAmosOffset();
        const requestEndpoint = `/api/get-amos.js?r=0&o=${offest}`;

        return fetch(requestEndpoint)
          .then(function(response) {
            return response.json();
          })
          .then(function(data) {
            console.log(data);
            setAmosOffset(getAmosOffset() + 1);
            //setAmosCount(data.pagination.total_count);
            const gifs = data.data;
            const gif = gifs[0];
            console.log('gifs', gif);
            gifElement.src = gif.images.downsized.url;
            //gifElement.src = gif.images.original.url;
            gifElement.alt = gif.title;
            gifElement.style.display = 'block';
          });
      }

      giveMeAmos.addEventListener('click', main);

      main();
    </script>
  </body>
</html>
